<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8" />
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui"
  />
  <meta name="renderer" content="webkit" />
  <meta
    name="theme-color"
    content="#9f8113"
    media="(prefers-color-scheme: light)"
  />
  <meta
    name="theme-color"
    content="#9f8113"
    media="(prefers-color-scheme: dark)"
  />
  <meta name="theme-color" content="#9f8113" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="referrer" content="no-referrer" />
  <meta name="format-detection" content="telephone=no,email=no,adress=no" />
  <!-- Color theme for statusbar -->
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
   
  <title>
    回顾：vue-cli老项目升级vite踩坑指南 | laputa z
  </title>
  <meta name="description" content="公司的项目大部分都是 2B 类型的中后台 PC 端项目，且业务都非常庞大。常年累月的维护下，使用 webpack dev 速度变得非常慢。因为最近的工作主要是负责一些前端的基础设施建设，各个业务线的产品都有一定的接触。有一个项目在我的电脑上面 npm run dev 居然要 6 分钟之久，实在是难以感到愉悦。加上公司内部已经新项目使用 vite 作为构建工具，所以挑选了一个自己比较熟悉的老项目(v">
<meta property="og:type" content="article">
<meta property="og:title" content="回顾：vue-cli老项目升级vite踩坑指南">
<meta property="og:url" content="https://laputaz.github.io/home/%E5%9B%9E%E9%A1%BE-vue-cli%E8%80%81%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7vite%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="River">
<meta property="og:description" content="公司的项目大部分都是 2B 类型的中后台 PC 端项目，且业务都非常庞大。常年累月的维护下，使用 webpack dev 速度变得非常慢。因为最近的工作主要是负责一些前端的基础设施建设，各个业务线的产品都有一定的接触。有一个项目在我的电脑上面 npm run dev 居然要 6 分钟之久，实在是难以感到愉悦。加上公司内部已经新项目使用 vite 作为构建工具，所以挑选了一个自己比较熟悉的老项目(v">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/e8aafc8ef8e34c19ba36c249319c71bd.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/87f546fb846c495da5e9862cebddec2d.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/d4eea77a2e37498ab1200570bc9bd2bd.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/9dce7314cb49452ba64caeccd4f23518.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/c894a8cb8e1344bcaaf015b349b76273.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/0005e80882b64d8484c9db9018a05cae.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/2966569538be435bb3a1935e273faa7f.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/49a0ba87450b43dabca22b73c2ee58d7.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/3069f1f802fc4c558eef7b7ea6a503b4.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/55298a16658f4011b360bce994cce630.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/9f2bdb9884734544b6f60a65ba9d95fb.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/7d84ad68d5ca40fc945ea54780417db8.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/65a7a346ed1442b6aa877d816996a660.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/361d77ae117f41e3a2475ef427e2f62f.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/8d07bcd1117d42448f629a7a453fde7e.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/d27d395ef4794630b6a5d63c58ef2a68.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/6ace0e3d1bf3489c8455a2cf5d953a0b.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/c48c4f7537ed43af8735f05b4cb7878a.png">
<meta property="article:published_time" content="2023-06-14T19:06:34.000Z">
<meta property="article:modified_time" content="2024-11-26T03:47:07.891Z">
<meta property="article:author" content="River">
<meta property="article:tag" content="回顾">
<meta property="article:tag" content="踩坑">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i-blog.csdnimg.cn/direct/e8aafc8ef8e34c19ba36c249319c71bd.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://laputaz.github.io/home/%E5%9B%9E%E9%A1%BE-vue-cli%E8%80%81%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7vite%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97/index.html" />
  
  <link
    rel="alternate"
    href="/atom.xml"
    title="River"
    type="application/atom+xml"
  />
   
  <link rel="icon" href="images/logo.svg" type="image/x-icon" />
   
<link rel="stylesheet" href="/home/css/style.css">
   
  <link
    href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css"
    rel="stylesheet"
  />
   
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&display=swap');
  </style>
  <style>
    body header {
      font-family: Ubuntu, 'PingHei', 'PingFang SC', Helvetica Neue, 'Work Sans',
        'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif !important;
    }
  </style>
<meta name="generator" content="Hexo 5.4.2"></head>


<body class="main-center theme-green" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
       
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img
            class="img-circle img-rotate"
            src="/home/images/logo.svg"
            width="200"
            height="200"
          />
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Laputa Z</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">
          
        </h3>
        <small id="location" class="hidden-xs hidden-sm"
          ><i class="icon icon-map-marker"></i>
          <a href=""
            >桦林</a
          ></small
        >
      </div>
       <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button
        class="navbar-toggle collapsed"
        type="button"
        data-toggle="collapse"
        data-target="#main-navbar"
        aria-controls="main-navbar"
        aria-expanded="false"
      >
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav
      id="main-navbar"
      class="collapse navbar-collapse"
      itemscope
      itemtype="http://schema.org/SiteNavigationElement"
      role="navigation"
    >
      <ul
        class="
          nav
          navbar-nav
          main-nav
          menu-highlight
        "
      >
         
        <li class="menu-item menu-item-home">
          <a href="/home/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
         
        <li class="menu-item menu-item-archives">
          <a href="/home/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
         
        <li class="menu-item menu-item-tags">
          <a href="/home/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
         
        <li class="menu-item menu-item-about">
          <a href="/home/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Slogan</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>向前看，别回头</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/home/tags/AB-Testing/" style="font-size: 13px;">AB Testing</a> <a href="/home/tags/ai/" style="font-size: 13px;">ai</a> <a href="/home/tags/css/" style="font-size: 13.44px;">css</a> <a href="/home/tags/hook/" style="font-size: 13px;">hook</a> <a href="/home/tags/javascript/" style="font-size: 13.78px;">javascript</a> <a href="/home/tags/lerna/" style="font-size: 13px;">lerna</a> <a href="/home/tags/npm/" style="font-size: 13.11px;">npm</a> <a href="/home/tags/sem/" style="font-size: 13px;">sem</a> <a href="/home/tags/shell/" style="font-size: 13px;">shell</a> <a href="/home/tags/vue/" style="font-size: 13.56px;">vue</a> <a href="/home/tags/webpack/" style="font-size: 13px;">webpack</a> <a href="/home/tags/websocket/" style="font-size: 13px;">websocket</a> <a href="/home/tags/yarn/" style="font-size: 13px;">yarn</a> <a href="/home/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/" style="font-size: 13.33px;">二进制</a> <a href="/home/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 13px;">人工智能</a> <a href="/home/tags/%E4%BF%84%E8%AF%AD%E7%AC%94%E8%AE%B0/" style="font-size: 13.22px;">俄语笔记</a> <a href="/home/tags/%E5%8C%85%E7%AE%A1%E7%90%86/" style="font-size: 13.11px;">包管理</a> <a href="/home/tags/%E5%9B%9E%E9%A1%BE/" style="font-size: 13.67px;">回顾</a> <a href="/home/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 14px;">基础</a> <a href="/home/tags/%E5%AE%9E%E7%8E%B0/" style="font-size: 13.11px;">实现</a> <a href="/home/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 13px;">小程序</a> <a href="/home/tags/%E6%89%8B%E5%86%99/" style="font-size: 13.89px;">手写</a> <a href="/home/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 13px;">排序</a> <a href="/home/tags/%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1/" style="font-size: 13.67px;">方案设计</a> <a href="/home/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size: 13.22px;">浏览器</a> <a href="/home/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.33px;">算法</a> <a href="/home/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 13px;">网络</a> <a href="/home/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 13px;">网络安全</a> <a href="/home/tags/%E8%B7%A8%E7%AB%AF/" style="font-size: 13px;">跨端</a> <a href="/home/tags/%E8%B8%A9%E5%9D%91/" style="font-size: 13.11px;">踩坑</a> <a href="/home/tags/%E8%BF%9B%E5%88%B6/" style="font-size: 13px;">进制</a> <a href="/home/tags/%E9%97%AE%E9%A2%98/" style="font-size: 13.11px;">问题</a> <a href="/home/tags/%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/" style="font-size: 13.22px;">高阶组件</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/home/archives/2023/">2023</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/home/archives/2022/">2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/home/archives/2021/">2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/home/archives/2020/">2020</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/home/archives/2019/">2019</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/home/archives/2018/">2018</a><span class="archive-list-count">14</span></li></ul>
    </div>
  </div>


    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-回顾-vue-cli老项目升级vite踩坑指南" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      回顾：vue-cli老项目升级vite踩坑指南
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/home/%E5%9B%9E%E9%A1%BE-vue-cli%E8%80%81%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7vite%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97/" class="article-date">
	  <time datetime="2023-06-14T19:06:34.000Z" itemprop="datePublished">2023-06-14</time>
	</a>
</span>
        
        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/home/tags/%E5%9B%9E%E9%A1%BE/" rel="tag">回顾</a>, <a class="article-tag-link-link" href="/home/tags/%E8%B8%A9%E5%9D%91/" rel="tag">踩坑</a>
  </span>


        

        <!-- <span class="post-comment"><i class="icon icon-comment"></i> <a href="/home/%E5%9B%9E%E9%A1%BE-vue-cli%E8%80%81%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7vite%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97/#comments" class="article-comment-link">评论</a></span> -->
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>公司的项目大部分都是 2B 类型的中后台 PC 端项目，且业务都非常庞大。常年累月的维护下，使用 webpack dev 速度变得非常慢。<br>因为最近的工作主要是负责一些前端的基础设施建设，各个业务线的产品都有一定的接触。有一个项目在我的电脑上面 npm run dev 居然要 6 分钟之久，实在是难以感到愉悦。加上公司内部已经新项目使用 vite 作为构建工具，所以挑选了一个自己比较熟悉的老项目(vue-cli)进行 vite 迁移。并将过程进行了记录。</p>
<span id="more"></span>

<h2 id="项目背景"><a href="#项目背景" class="headerlink" title="项目背景"></a>项目背景</h2><p>先简单说明一下项目的情况：</p>
<ul>
<li><p>内容：2B 的 PC 端中后台管理系统，是一个双入口的应用（登录页一个入口，管理系统一个入口）。</p>
</li>
<li><p>构建工具：vue-cli-service</p>
</li>
<li><p>技术栈：vue 2.6 + Axios + Vuex + Vue-Router + sf-vue-componet(公司内部组件库) + ElementUI</p>
</li>
<li><p>维护时长：3 年+，（实际上应该远远超过五年，这个项目是以一个已经维护了很久的项目为基础进行开发的，而当前最早的一条 commit 记录是 3 年前，但是这个基础项目已经开发很久时间了）</p>
</li>
<li><p>模块数量：6000（npm run serve 时显示的模块数量）</p>
</li>
<li><p>业务代码量：19.3W 行</p>
</li>
<li><p>兼容性要求：IE11</p>
</li>
</ul>
<p>项目的体量在公司内部只能算是中等，之所以挑选这个项目进行处理是因为对这个业务比较熟悉。话不多说，开搞。</p>
<h2 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h2><p>本次的目的不是直接用 vite 替换 vue-cli，而是想同时保留 vite 和 vue-cli。除去影响开发体验也主要是集中在 dev 这一块的原因外，还有以下两点：</p>
<ul>
<li><p>产品需要兼容 IE11，尚不清楚 vite 在此方面有多少坑。步子迈太大了，可能扯着胯。</p>
</li>
<li><p>rollup 打包机制毕竟和 webpack 还是不同，且业务也比较复杂。修改完成之后也很难保证所有业务都能测试到位。</p>
</li>
</ul>
<p>webpack 和 vite 本质上都是入口文件 + 依赖分析 + 模块转换。vite 是 使用的时候进行处理（vite 针对第三方库有同样会进行预处理），webpack 则是先全部处理完毕。当浏览器天然支持 ES module 之后，实时处理变得可能。这也是 vite 启动速度快的原因。<br>所以，从理论上来说，从 Vue-cli 迁移到 vite 是可行的。</p>
<h2 id="开始迁移"><a href="#开始迁移" class="headerlink" title="开始迁移"></a>开始迁移</h2><h3 id="step1-分析-vue-config-js"><a href="#step1-分析-vue-config-js" class="headerlink" title="step1 分析 vue.config.js"></a>step1 分析 vue.config.js</h3><p>首先，我们先进行 vue.config.js 进行分析。主要是把一些插件，和比较特殊的配置整理出来。然后再去 vite 官网和社区查看，看是匹配的配置或者插件。把其中不匹配的部分进行解决，估计迁移也就差不多了。</p>
<p>分析完成之后主要两点无法匹配的情况</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">plugins</span>.<span class="title function_">delete</span>(<span class="string">&#x27;preload-loginPlatform&#x27;</span>);</span><br><span class="line">    config.<span class="property">plugins</span>.<span class="title function_">delete</span>(<span class="string">&#x27;prefetch-loginPlatform&#x27;</span>);</span><br><span class="line">    config.<span class="property">plugins</span>.<span class="title function_">delete</span>(<span class="string">&#x27;preload-platform&#x27;</span>);</span><br><span class="line">    config.<span class="property">plugins</span>.<span class="title function_">delete</span>(<span class="string">&#x27;prefetch-platform&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">transpileDependencies</span>: [</span><br><span class="line">    <span class="string">&#x27;@sxf/cloudsec-components&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@sxf/validations&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@sxf/sf-vue-component&#x27;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>chainWebpack 中的配置主要是为了解决两个入口资源互相加载的问题，即访问登录页时，会预加载管理系统资源。由于这个是打包后在生产环境中才会用到的内容，且这次迁移无需关系打包的内容，所以暂时不用处理。<br>transpileDependencies 主要是让 node_modules 中的文件也进行 babel 的处理，而我们在开发时可以使用最新的浏览器，完全可以不用 babel，所以这个问题也不用处理。</p>
<p><a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/config/#transpiledependencies">https://cli.vuejs.org/zh/config/#transpiledependencies</a></p>
<h3 id="step2-安装依赖，添加-scripts"><a href="#step2-安装依赖，添加-scripts" class="headerlink" title="step2 安装依赖，添加 scripts"></a>step2 安装依赖，添加 scripts</h3><p>一般情况下，会需要用到以下的 npm 包。</p>
<ul>
<li>vite</li>
<li>vite-plugin-vue2：vite 支持 vue2 的插件（默认情况下，vite 并不支持 vue）</li>
<li>vite-plugin-eslint（可选）：vite eslint 插件，用于在 run dev 时，实时校验 eslint</li>
<li>vite-plugin-legacy（可选）：处理浏览器兼容性，本次这里不需要。</li>
<li>vite-plugin-mock（可选）：mock 数据</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add vite vite-plugin-vue2 -D # 这里只安装了必要的vite 与 vite vue2插件</span><br></pre></td></tr></table></figure>

<p>然后添加 package.json 中 添加 scripts 命令。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    ...<span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scirpts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        ...<span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="step3-编写-vite-config-js-文件"><a href="#step3-编写-vite-config-js-文件" class="headerlink" title="step3 编写 vite.config.js 文件"></a>step3 编写 vite.config.js 文件</h3><p>因为原本的 vue.config.js 不是特别复杂，网上也有其他迁移的文章讲解如何迁移 webpack 配置，所以我这里直接粘贴结果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createVuePlugin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;vite-plugin-vue2&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">        <span class="attr">https</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="number">4433</span>,</span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;/platform&#x27;</span>: &#123;</span><br><span class="line">                <span class="attr">target</span>: <span class="string">`https://<span class="subst">$&#123;config.host&#125;</span>`</span>,</span><br><span class="line">                <span class="attr">secure</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/platform/</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            ... <span class="comment">//</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;@&#x27;</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;src&#x27;</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;home&#x27;</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src/home&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;components&#x27;</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src/components&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;assets&#x27;</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src/assets&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;utils&#x27;</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src/utils&#x27;</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">build</span>: &#123; <span class="comment">// 这里是build时才会用到，所以这里可以省略</span></span><br><span class="line">      <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">        <span class="attr">input</span>: &#123;</span><br><span class="line">          <span class="attr">login</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./public/login_platform.html&#x27;</span>),</span><br><span class="line">          <span class="attr">platform</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./public/platform.html&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">createVuePlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>从上面的结果来看其实只用写三个部分的内容：</p>
<ul>
<li>serve: 开发时的运行端口，以及数据请求的反向代理的规则</li>
<li>alias: 别名</li>
<li>plugins: 引入 vite-plugin-vue2 用于加载 vue 文件。</li>
</ul>
<h3 id="关于多入口"><a href="#关于多入口" class="headerlink" title="关于多入口"></a>关于多入口</h3><p>在项目介绍的时候说到，项目是一个多入口的文件。实际上在 vite 的开发环境中，多入口无需配置。启动文件之后直接访问对应的 html 资源即可。</p>
<h3 id="关于-wp2vite"><a href="#关于-wp2vite" class="headerlink" title="关于 wp2vite"></a>关于 wp2vite</h3><p><a target="_blank" rel="noopener" href="https://github.com/tnfe/wp2vite">https://github.com/tnfe/wp2vite</a> (一个前端项目转换工具，可以让 webpack 项目支持 vite)</p>
<p>wp2vite 能够将根据你当前的 webpack 配置生成 vite 配置（支持 vue-cli），如果不想手写 vite.config.js 可以使用该工具进行自动转换。我是在撰写本文整理资料时，才发现有此工具。</p>
<p>wp2vite 转换的结果并非完全正确，存在以下问题。</p>
<ul>
<li>alias 添加了一些莫名其妙的别名 （也有可能是 Feature :smile:）</li>
<li>proxy 配置 rewrite 不正确</li>
</ul>
<p>以上两点，各位同学在参考的时候注意一下就行。</p>
<h3 id="step-4-调整入口文件"><a href="#step-4-调整入口文件" class="headerlink" title="step 4 调整入口文件"></a>step 4 调整入口文件</h3><p>与 vue-cli 有区别的是，vite 默认只能将 html 作为入口文件，所以需要对 HTML 内容进行调整。</p>
<p>别忘记给 script 标签添加 type=”module”</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html 主应用的入口文件 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">      <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>...<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加这一行直接引入之前的 入口文件 --&gt;</span></span><br><span class="line">    +</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">&quot;module&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;/src/main.js&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span></span></span><br><span class="line"><span class="tag">        &gt;</span>We&#x27;re sorry but project doesn&#x27;t work properly without JavaScript</span><br><span class="line">        enabled. Please enable it to continue.&lt;/strong</span><br><span class="line">      &gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- login.html 登录页的入口文件 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">      <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>...<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加这一行直接引入之前的 入口文件 --&gt;</span></span><br><span class="line">    +</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">&quot;module&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;/src/login.js&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span></span></span><br><span class="line"><span class="tag">        &gt;</span>We&#x27;re sorry but project doesn&#x27;t work properly without JavaScript</span><br><span class="line">        enabled. Please enable it to continue.&lt;/strong</span><br><span class="line">      &gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="step-5-npm-run-dev"><a href="#step-5-npm-run-dev" class="headerlink" title="step 5 npm run dev"></a>step 5 npm run dev</h3><p>直接运行 npm run dev，可以发现 vite 马上就开启了服务。相对于原来 70s 左右的时间，这快了可不止一星半点，简直就是火箭起飞。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/e8aafc8ef8e34c19ba36c249319c71bd.png" alt="在这里插入图片描述"></p>
<p>当然，服务的启动并不代表迁移已经完成。vite 更多的是在访问对应的资源时才会去处理内容。所以需要访问对应的页面来进行验证。而真正的迁移，才刚刚开始。</p>
<h2 id="无尽采坑：阶段一"><a href="#无尽采坑：阶段一" class="headerlink" title="无尽采坑：阶段一"></a>无尽采坑：阶段一</h2><h3 id="问题-1：URIError-URI-malformed"><a href="#问题-1：URIError-URI-malformed" class="headerlink" title="问题 1：URIError: URI malformed"></a>问题 1：URIError: URI malformed</h3><p>vite 开启之后，访问登录页 <a target="_blank" rel="noopener" href="https://localhost:4433/static/login_platform.html%EF%BC%8C%E6%8A%A5%E9%94%99">https://localhost:4433/static/login_platform.html，报错</a> URIError: URI malformed</p>
<p><img src="https://i-blog.csdnimg.cn/direct/87f546fb846c495da5e9862cebddec2d.png" alt="在这里插入图片描述"></p>
<p>这是 decodeURIComponent 函数在执行时报的错。<br>通过在错误堆栈中，加上 console 语句，得知出错的 URI 是/static/%3C%=%20BASE_URL%20%%3Efavicon.ico<br>对应的代码则是 login.html 中的代码，这里的 BASE_URL 是 vue-cli 中模板变量的写法，这里可以修改为/public/favicon.ico（根据自己的目录结构调整，切勿盲目套用）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">  <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">href</span>=<span class="string">&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line">=&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">  <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">href</span>=<span class="string">&quot;/public/favicon.ico&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改完成之后，vite 则提示去掉 public 前缀，那我们直接去掉就行。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/d4eea77a2e37498ab1200570bc9bd2bd.png" alt="在这里插入图片描述"></p>
<h3 id="问题-2：Failed-to-resolve-import-“xxx”"><a href="#问题-2：Failed-to-resolve-import-“xxx”" class="headerlink" title="问题 2：Failed to resolve import “xxx”"></a>问题 2：Failed to resolve import “xxx”</h3><p><img src="https://i-blog.csdnimg.cn/direct/9dce7314cb49452ba64caeccd4f23518.png" alt="在这里插入图片描述"></p>
<p>提示找不到对应的 vue 文件（实际肯定是有）。经过查阅资料这一块主要是为了类型提示的问题（ts 的项目）,vite 不在自动查找.vue 扩展名的文件。<br>这里只需要补全 PageLogin.vue 即可。 在这里补全.vue 扩展名不太现实，因为项目里面大部分都是省略了扩展名的。好在官方给出了解决的方案，直接配置即可。</p>
<p><a target="_blank" rel="noopener" href="https://cn.vitejs.dev/config/#resolve-extensions">https://cn.vitejs.dev/config/#resolve-extensions</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">resolve.extensions</span><br><span class="line"></span><br><span class="line">类型： string[]</span><br><span class="line">默认： [&#x27;.mjs&#x27;, &#x27;.js&#x27;, &#x27;.ts&#x27;, &#x27;.jsx&#x27;, &#x27;.tsx&#x27;, &#x27;.json&#x27;]</span><br><span class="line"></span><br><span class="line">导入时想要省略的扩展名列表。注意，不 建议忽略自定义导入类型的扩展名（例如：.vue），因为它会影响 IDE 和类型支持。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置 resolve.extensions 的方式，并不能够完全的解决问题。这里卖个关子，后面会继续遇到因为缺少.vue 扩展名而导致的问题。那里会给出完美的解决方案。</p>
<h3 id="问题-3-less-import"><a href="#问题-3-less-import" class="headerlink" title="问题 3: less import"></a>问题 3: less import</h3><p>修复完问题 2 之后，继续访问页面。这个时候又出了新的问题。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/c894a8cb8e1344bcaaf015b349b76273.png" alt="在这里插入图片描述"></p>
<p>经过查阅资料，vite 对 less 和 sass 文件的 import 进行了优化的处理，不在需要在别名前添加 ~符号来进行识别。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vite 为 Sass 和 Less 改进了 @import 解析，以保证 vite 别名也能被使用。另外，url() 中的相对路径引用的，与根文件不同目录中的 Sass/Less 文件会自动变基以保证正确性。</span><br><span class="line">由于 Stylus API 限制，@import 别名和 URL 变基不支持 Stylus。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里就只需要全局搜索然后全局替换就行，如果有发现全局没有替换到的（多了空格什么的），手动替换一下就行。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/0005e80882b64d8484c9db9018a05cae.png" alt="在这里插入图片描述"></p>
<h3 id="问题-4：net-ERR-ABORTED-408-Request-Timeout"><a href="#问题-4：net-ERR-ABORTED-408-Request-Timeout" class="headerlink" title="问题 4：net::ERR_ABORTED 408 (Request Timeout)"></a>问题 4：net::ERR_ABORTED 408 (Request Timeout)</h3><p>修复好问题 3，再次访问时出现很多资源 408 的错误。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/2966569538be435bb3a1935e273faa7f.png" alt="在这里插入图片描述"></p>
<p>出现这个问题不要慌，重新刷新即可，这是 vite 在对一些依赖进行预构建。因为是请求到对应的资源才会进行预构建，在碰到需要预构建的包后，vite 直接返回了 408。</p>
<p>有时候需要重新刷新多次，每次构建完成之后重新刷新，如果发现新的需要预构建的依赖会再次返回 408</p>
<p><img src="https://i-blog.csdnimg.cn/direct/49a0ba87450b43dabca22b73c2ee58d7.png" alt="在这里插入图片描述"></p>
<p>至于这里为什么返回 408，而不是直接挂起请求预构建完成之后再返回，个人不是很清楚。有了解 vite 原理的同学可以解答下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vite 将有许多内部模块的 ESM 依赖关系转换为单个模块，以提高后续页面加载性能。</span><br><span class="line">一些包将它们的 ES 模块构建作为许多单独的文件相互导入。例如，lodash-es 有超过 600 个内置模块！当我们执行 import &#123; debounce &#125; from &#x27;lodash-es&#x27; 时，浏览器同时发出 600 多个 HTTP 请求！尽管服务器在处理这些请求时没有问题，但大量的请求会在浏览器端造成网络拥塞，导致页面的加载速度相当慢。</span><br><span class="line">通过预构建 lodash-es 成为一个模块，我们就只需要一个 HTTP 请求了！</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="问题-5：Vue-warn：runtime-only"><a href="#问题-5：Vue-warn：runtime-only" class="headerlink" title="问题 5：Vue warn：runtime-only"></a>问题 5：Vue warn：runtime-only</h3><p>等待所有内容都预构建完成之后，又出现了新的问题。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/3069f1f802fc4c558eef7b7ea6a503b4.png" alt="在这里插入图片描述"></p>
<p>这里问题比较好理解，vue 的默认引用的内容是不包含模板编译功能的。因为之前使用的是 vue-cli，毕竟是一家的东西 vue-cli 针对这个情况做了特殊的处理。</p>
<p>这种情况在 vite.config.js 中，添加一条别名即可解决。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;@&#x27;</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">            ......,</span><br><span class="line">            <span class="string">&#x27;vue&#x27;</span>: <span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;vue/dist/vue.esm.js&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="问题-6：require-is-not-defined"><a href="#问题-6：require-is-not-defined" class="headerlink" title="问题 6：require is not defined"></a>问题 6：require is not defined</h3><p><img src="https://i-blog.csdnimg.cn/direct/55298a16658f4011b360bce994cce630.png" alt="在这里插入图片描述"></p>
<p>这里继续爆出来 import 的问题，但是这里肯定不是因为确实 .vue 扩展名引起的。经过分析，问题的原因是业务代码中使用了 require 语句，而 vite 主要是依赖于 ES module 机制。这也就导致无法识别该业务代码，进而导致该模块加载失败。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这里吐槽下，这里 vite 控制台 和 浏览器控制台爆出了不同的错误，而 vite 控制台的错误信息完全没法排查思路。</span><br><span class="line"></span><br><span class="line">而在迁移前期，一直盯着 vite 控制台，这就导致一个很简单的问题实际上花费了很多的时间。</span><br></pre></td></tr></table></figure>

<p>这种情况下，需要手动对业务代码进行处理。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">image</span>: <span class="built_in">require</span>(<span class="string">&#x27;@uedc/login/dist/static/copyright/copyright-zh_CN@2016-2021.png&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// =&gt;</span></span><br><span class="line"><span class="keyword">import</span> copyright <span class="keyword">from</span> <span class="string">&#x27;@uedc/login/dist/static/copyright/copyright-zh_CN@2016-2021.png&#x27;</span>;</span><br><span class="line">&#123;</span><br><span class="line">  image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="采坑阶段一总结"><a href="#采坑阶段一总结" class="headerlink" title="采坑阶段一总结"></a>采坑阶段一总结</h2><p>修改完上述问题之后，本项目的多入口应用中的一个登录页面入口，终于可以正常展示了。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/9f2bdb9884734544b6f60a65ba9d95fb.png" alt="在这里插入图片描述"></p>
<ul>
<li>vite 控制台，chrome 控制台均无报错</li>
<li>之前修改的 require 改为 import 的 logo，正常显示</li>
<li>通过网络请加载的验证码，正常显示（说明反向代理这些都是正常的）</li>
</ul>
<p>虽然遇到问题还是比较多，但是解决起来都不是很费时间，排查起来也比较顺利。至此迁移工作可以说已经进行了一半。除去 html 模板文件中修改 favicon.ico 和导入图片的 requrie 之外，没有改动其他的业务代码，对业务的入侵很小。<br>话不多说，输入账号密码，开启第二个阶段的采坑。</p>
<h2 id="无尽采坑：阶段二"><a href="#无尽采坑：阶段二" class="headerlink" title="无尽采坑：阶段二"></a>无尽采坑：阶段二</h2><h3 id="问题-7：-uses-lang-html-for-template"><a href="#问题-7：-uses-lang-html-for-template" class="headerlink" title="问题 7： uses lang html for template"></a>问题 7： uses lang html for template</h3><p><img src="https://i-blog.csdnimg.cn/direct/7d84ad68d5ca40fc945ea54780417db8.png" alt="在这里插入图片描述"></p>
<p>这是一个相当无语的错误，应该是 vite-plugin-vue2 插件的 bug。问题的原因是在 template 中，写了 lang=”html”</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">lang</span>=<span class="string">&quot;html&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>.....<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>虽然模板默认就是 html，这个声明时多此一举，但是报错感觉不应该。<br>好在这个问题比较好解决，通过查找字符串全局替换即可。你问我为什么要多此一举要声明 lang=”html”?我也不知道，这不就是老项目的魅力嘛。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/65a7a346ed1442b6aa877d816996a660.png" alt="在这里插入图片描述"></p>
<h3 id="问题-8：-npm-包出错"><a href="#问题-8：-npm-包出错" class="headerlink" title="问题 8： npm 包出错"></a>问题 8： npm 包出错</h3><p><img src="https://i-blog.csdnimg.cn/direct/361d77ae117f41e3a2475ef427e2f62f.png" alt="在这里插入图片描述"></p>
<p>这也是本次迁移过程中，最为棘手的问题。不止一个 npm 包出错，且出错的内容也不一样。有些出错可以通过 vite 的配置解决，有些则无法解决。</p>
<p>一般来说有以下几种方法来解决 npm 包报错的问题。</p>
<h4 id="方法一：修改别名，指向源码"><a href="#方法一：修改别名，指向源码" class="headerlink" title="方法一：修改别名，指向源码"></a>方法一：修改别名，指向源码</h4><p>即在 vite.config.js 中添加 alias</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;@sxf/sp-qrcode&#x27;: resolve(__dirname, &#x27;./node_modules/@sxf/sp-qrcode/src/index.js&#x27;),</span><br></pre></td></tr></table></figure>

<p>这种方法适用于 npm 包的源码是用 ES module 规范编写的，且上传的 npm 包中包含了源码。</p>
<h4 id="方法二：修改别名，指向-esm-格式的打包文件"><a href="#方法二：修改别名，指向-esm-格式的打包文件" class="headerlink" title="方法二：修改别名，指向 esm 格式的打包文件"></a>方法二：修改别名，指向 esm 格式的打包文件</h4><p>修改方式同方法一，只不过是执行打包后的 esm 文件。<br>这种方式适用于 npm 包已经 build 了 esm 模块的内容，但是未在 packages.json 中提供 module 字段指向对应的文件。<br>一般开源的，使用人数较多的 npm 包不会出现这种情况，只是因为这次出问题有一些是内部的包，确实存在 build 了 esm 的文件，但是没有在 package.json 中指明的情况。</p>
<h4 id="方案三：optimiziDep-include"><a href="#方案三：optimiziDep-include" class="headerlink" title="方案三：optimiziDep.include"></a>方案三：optimiziDep.include</h4><p>默认情况下，不在 node_modules 中的，链接的包不会被预构建。使用此选项可强制预构建链接的包。</p>
<p>从官网的文档的描述信息来看 optimiziDep.include 是无法解决 npm 包出错的问题。因为不管怎样，node_modules 中的内容都会被预构建。但是从实际的使用中来看</p>
<ul>
<li>在 vite 2.4.4 中，optimiziDep.include 能够解决部分 npm 加载的问题。</li>
<li>在 vite 2.5.3 中，optimiziDep.include 不再起作用。</li>
</ul>
<p>因为 vite 一直在高速迭代，保不齐部分情况下此方法依旧有用。</p>
<h4 id="方案四：参考问题-10"><a href="#方案四：参考问题-10" class="headerlink" title="方案四：参考问题 10"></a>方案四：参考问题 10</h4><p>问题 10 也是 npm 出问题，但是这个问题比较具有代表性，所以单独拿出来。</p>
<h4 id="方案五：换个-npm-包，或者修改-npm-包"><a href="#方案五：换个-npm-包，或者修改-npm-包" class="headerlink" title="方案五：换个 npm 包，或者修改 npm 包"></a>方案五：换个 npm 包，或者修改 npm 包</h4><p>如果上面三种方案都无法解决，那就只能从 npm 包本身下手了。</p>
<p>对于自己内部维护 npm 包，可以重新打包一个 ES module 的文件并发布。这里推荐用 rollup 打包，能够很轻松的构建 CommonJS、ES module、UMD、IIFE 格式的文件</p>
<p>对于第三方的 npm 包，出现这种情况应该是很久没有维护了，所以也应该换一个了。</p>
<h3 id="问题-9：Failed-to-resolve-entry-ops，same-proplem"><a href="#问题-9：Failed-to-resolve-entry-ops，same-proplem" class="headerlink" title="问题 9：Failed to resolve entry (ops，same proplem)"></a>问题 9：Failed to resolve entry (ops，same proplem)</h3><p>出现问题原因与问题 2 相同，也是因为没有.vue 扩展名的问题。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/8d07bcd1117d42448f629a7a453fde7e.png" alt="在这里插入图片描述"></p>
<p>@sxf/cloudsec-component 是一个自己维护的业务组件库，基于基础的 UI 组件库，将一些常用的业务进行封装，单独发布一个 npm 包。主要是为了方便同一个开发团队维护多个产品（这点与公司组织架构有一定的关系，不在深究）。因为业务组件需要调试的原因，npm 发布的是.vue 的源码。<br>同样因为保持着相同的编码规范，业务中对组件库的引用，以及组件库本身开发时的互相引用都是省略了.vue 扩展的。<br>而以上两种方案都无法通过 resolve.extensions 解决。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在 vite 2.4.4 的版本中，配置了 resolve.extensions 之后，无法识别 vue-router 中的 () =&gt; import(&#x27;foo/bar/baz&#x27;)</span><br><span class="line">这个问题在 vite 2.5.3 中进行了修复，如果出现了此类问题，可以升级一下 vite 版本。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="解决方案一：人肉修改"><a href="#解决方案一：人肉修改" class="headerlink" title="解决方案一：人肉修改"></a>解决方案一：人肉修改</h4><p>人肉一个个修改，这种情况适用于刚开始不久的项目。但是对于一个维护数年的老项目来说，这基本不现实。20W 行左右的代码，几千个 vue 文件。作为程序员明显不能这么干活。</p>
<h4 id="解决方案二：vite-插件"><a href="#解决方案二：vite-插件" class="headerlink" title="解决方案二：vite 插件"></a>解决方案二：vite 插件</h4><p>vite 插件的第一个例子就是讲的引入一个虚拟文件，这里的问题其实类似。就是没有补充扩展名，导致找不到，那么可以通过插件查找。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/d27d395ef4794630b6a5d63c58ef2a68.png" alt="在这里插入图片描述"></p>
<p>这里提供一下伪代码，未进行实际的验证。</p>
<p>因为这只是解决了 vite 加载的问题，但是没有解决类型提示的问题，这对于后续进行 ts 相关改造不友好，所以没有去验证此方案。</p>
<p>感兴趣的可以验证一下，个人在实际的业务中是采用的方案三。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;vite-plugin-fix-vue-ext&#x27;</span>,</span><br><span class="line">    <span class="title function_">resolveId</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="comment">// 判断是否需要补充后缀，如果需要则返回id，表示命中。</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isNeedFixExt</span>(id)) <span class="keyword">return</span> id;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">load</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isNeedFixExt</span>(id)) <span class="keyword">return</span> fs.<span class="title function_">readFileSync</span>(<span class="title function_">fixExt</span>(id));</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="问题-10：-does-not-provide-an-export-named-‘default’"><a href="#问题-10：-does-not-provide-an-export-named-‘default’" class="headerlink" title="问题 10： does not provide an export named ‘default’"></a>问题 10： does not provide an export named ‘default’</h3><p>这个问题是因为第三方的 npm 包是提供的是 CommonJS 规范的文件。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/6ace0e3d1bf3489c8455a2cf5d953a0b.png" alt="在这里插入图片描述"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CommonJS 和 UMD 兼容性: 开发阶段中，vite 的开发服务器将所有代码视为原生 ES 模块。因此，vite 必须先将作为 CommonJS 或 UMD 发布的依赖项转换为 ESM。</span><br></pre></td></tr></table></figure>

<p>vite 官网说，会兼容 CommonJS 格式的文件，但是这里为什么还是因为 CommonJS 格式的问题呢？<br>其实这个文件是可以 import 导入的只是并没有提供 default 这个属性，这么说 vite 也确实支持了 CommonJS。<br>遇到这种情况我们需要引入 @originjs/vite-plugin-CommonJS 这个包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; viteCommonJS &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@originjs/vite-plugin-CommonJS&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">viteCommonJS</span>(&#123;</span><br><span class="line">      <span class="attr">include</span>: [<span class="string">&#x27;procurios.resizesensor&#x27;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">createVuePlugin</span>(),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="采坑阶段二总结"><a href="#采坑阶段二总结" class="headerlink" title="采坑阶段二总结"></a>采坑阶段二总结</h2><p>在 主入口页面的迁移过程中，改动了非常多的代码。</p>
<ul>
<li>业务代码 293 个文件</li>
<li>业务组件的代码 139 个文件</li>
</ul>
<p>但是修改这些文件大多数没有修改业务，只是补全了链接。但是 less 的文件 import 却是和 webpack 不兼容。<br>此外，还有有一些有问题的 npm 包，这次迁移的过程并没有完全解决,只是将对应的代码给注释。<br>最终通过以上措施，终于能够访问了，也看到了主入口的页面。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/c48c4f7537ed43af8735f05b4cb7878a.png" alt="在这里插入图片描述"></p>
<h2 id="最终总结"><a href="#最终总结" class="headerlink" title="最终总结"></a>最终总结</h2><p>vite 优点大家都知道，我主要来说一下现阶段的缺点。<br>总的来说现阶段的 vite 还存在以下问题：</p>
<ul>
<li>手动重新 npm run dev 后，预构建之后缓存丢失，而修改 vite.config.js 导致的自动重启不会。</li>
<li>预构建需要访问到对应的文件才能触发，会导致频繁 408，且速度非常慢。整个下来时间比较久，而且需要你手动刷新浏览器。比较奇怪的是 vite 2.4.4 在这方面 比 vite 2.5.3 快非常多，基本上只会出现一次 408。</li>
<li>无法很好的处理非 ES module 的 npm 包，与 webpack 还存在一定的差距。</li>
<li>请求数量巨大，从 network 的面板来看，请求的数量高达 468，除去 XHR 请求之外也有将近 400 个请求。所以首次加载的时间比较慢大概花了 5 秒，这一块应该是可以通过 vite 的配置来优化。等内部的一些 npm 包调整完毕能够进行正常的开发之后，会总结一些开发的实践并发出来。</li>
<li>功能不稳定。在早期使用 vite 2.4.4 进行迁移时，问题稍微还多一些。之后更新到 vite 2.5.3 之后，部分问题被修复了，但是也增加了一些新的问题。</li>
</ul>
<p>针对老项目需要迁移到 vite，需要考虑以下情况：</p>
<ul>
<li>不在支持非 ES module 的业务代码（如 require，module.exports），如果有这些代码需要进行调整，可以尝试与问题 9 相同的方式。</li>
<li>less/sass 的@import: vite 不在需要 ~ 来使用别名，这一点与 webpack 不兼容。</li>
<li>因为 IE11 天然不支持 ES module，所以 IE 调试比较麻烦，不建议需要支持 IE11 的项目将 vite 作为唯一的构建工具。</li>
<li>现阶段的 vite 对 npm 包有着较高的要求，迁移之前可以先看下项目的 npm 包，该替换的替换，该升级的升级。</li>
</ul>
<p>整体来说，vite 的开发体验比较好，轻量且快。即便是一个臃肿的老项目也能够做到反应迅速且不占用过多资源。项目较大时 webpack 启动时会占用大量的电脑资源，导致这一段时间 VSCode 非常卡，这一点体验非常不好。</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <!-- 
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://laputaz.github.io/home/%E5%9B%9E%E9%A1%BE-vue-cli%E8%80%81%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7vite%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97/" title="回顾：vue-cli老项目升级vite踩坑指南" target="_blank" rel="external">https://laputaz.github.io/home/回顾-vue-cli老项目升级vite踩坑指南/</a>
    </li>
     -->
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用
      <a
        href="http://creativecommons.org/licenses/by/4.0/deed.zh"
        target="_blank"
        rel="external"
        >CC BY 4.0 CN协议</a
      >
      许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>
 
<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a
          href=""
          target="_blank"
          class="img-burn thumb-sm visible-lg"
        >
          <img
            src="/home/images/logo.svg"
            class="img-rounded w-full"
            alt=""
          />
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading">
          <a href="" target="_blank"
            ><span class="text-dark">Laputa Z</span
            ><small class="ml-1x"></small></a
          >
        </h3>
        <div>Жизнь, как качели - то вверх, то вниз.</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/home/%E5%9B%9E%E9%A1%BE-sem%E7%9A%84%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/" title="回顾：Marketing 和 SEM 的相关知识"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/home/%E8%BF%9B%E5%88%B6%EF%BC%88%E5%9B%9B%EF%BC%89%E5%88%A9%E7%94%A8%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%A7%A3%E7%A0%81wbmp%E5%B9%B6%E8%BD%AC%E6%8D%A2%E4%B8%BApng%E5%9B%BE%E7%89%87/" title="进制（四）：利用二进制解码 wbmp 并转换为 png 图片"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
    <!-- <div class="copyright">
    	
        &copy; 2024 River
        
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div> -->
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/home/js/plugin.min.js"></script>


<script src="/home/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/home/',
        CONTENT_URL: '/home/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/home/js/insight.js"></script>



    <script>
(function ($) {
    $('.search-form').on('submit', function (e) {
        var keyword = $('.search-form-input[name="wd"]').val();
        window.location = 'https://www.baidu.com/s?wd=site:laputaz.github.io/home ' + keyword;
        return false;
    });
})(jQuery);
</script>




   




   


  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script>
  <script>
  //利用 FancyBox 实现点击图片放大
  $(document).ready(function() {
    $('article img').not('[hidden]').not('.panel-body img').each(function() {
      var $image = $(this);
      var imageCaption = $image.attr('alt');
      var $imageWrapLink = $image.parent('a');
      if ($imageWrapLink.length < 1) {
        var src = this.getAttribute('src');
        var idx = src.lastIndexOf('?');
        if (idx != -1) {
          src = src.substring(0, idx);
        }
        $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
      }
      $imageWrapLink.attr('data-fancybox', 'images');
      if (imageCaption) {
        $imageWrapLink.attr('data-caption', imageCaption);
      }
    });
    $().fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
    });
  });
  </script>





</body>
</html>